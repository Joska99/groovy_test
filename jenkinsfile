pipeline { 
    agent {
        label 'agent1'
    }
    tools {
        dockerTool 'docker'
        dockerTool 'helm'
        dockerTool 'k8s'
    }
    environment  {
        // Docker
        IMG_NAME_APP = 'weather-app'
        VERSION = 'jenkins'
        // Helm
        HELM_PACKAGE_DIR = ''
        HELM_PACKAGE = ''
        HELM_REPO = ''
    }

    stages {
        // stage('checkout code') {
        //     steps {
        //         checkout scm
        //     }
        // }
        stage('build docker image') {
            when {
                branch 'main'
            }
            steps {
                script {
                    //! print all ENV in Declarative mode
                    // sh 'printenv'
                    //! Using Docker from Tools
                    sh 'docker build -t joska99/weather-app:jenkins ./jenkins_project/py_app/'
                    sh 'docker images'
                }
            }
        }
        stage('Helm deploy') {
            when {
                branch 'main'
            }
            steps {
                script {
                    //! Using Helm from DockerTols (find custom tools)
                    sh 'helm version'
                    sh 'kubectl version --client'
                }
            }
        }
    }
}
